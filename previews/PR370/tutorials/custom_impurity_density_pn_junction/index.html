<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Advanced Example: Custom Impurity Profile · SolidStateDetectors.jl</title><meta name="title" content="Advanced Example: Custom Impurity Profile · SolidStateDetectors.jl"/><meta property="og:title" content="Advanced Example: Custom Impurity Profile · SolidStateDetectors.jl"/><meta property="twitter:title" content="Advanced Example: Custom Impurity Profile · SolidStateDetectors.jl"/><meta name="description" content="Documentation for SolidStateDetectors.jl."/><meta property="og:description" content="Documentation for SolidStateDetectors.jl."/><meta property="twitter:description" content="Documentation for SolidStateDetectors.jl."/><meta property="og:url" content="https://JuliaPhysics.github.io/SolidStateDetectors.jl/stable/tutorials/custom_impurity_density_pn_junction/"/><meta property="twitter:url" content="https://JuliaPhysics.github.io/SolidStateDetectors.jl/stable/tutorials/custom_impurity_density_pn_junction/"/><link rel="canonical" href="https://JuliaPhysics.github.io/SolidStateDetectors.jl/stable/tutorials/custom_impurity_density_pn_junction/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="SolidStateDetectors.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">SolidStateDetectors.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../man/installation/">Installation</a></li><li><a class="tocitem" href="../../man/config_files/">Configuration Files</a></li><li><a class="tocitem" href="../../man/csg/">Constructive Solid Geometry (CSG)</a></li><li><a class="tocitem" href="../../man/Grids/">Grids</a></li><li><a class="tocitem" href="../../man/electric_potential/">Electric Potential</a></li><li><a class="tocitem" href="../../man/electric_field/">Electric Field</a></li><li><a class="tocitem" href="../../man/charge_drift/">Charge Drift</a></li><li><a class="tocitem" href="../../man/weighting_potentials/">Weighting Potentials</a></li><li><a class="tocitem" href="../../man/capacitances/">Capacitances</a></li><li><a class="tocitem" href="../../man/IO/">IO</a></li><li><a class="tocitem" href="../../man/plotting/">Plotting</a></li></ul></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../complete_simulation_chain_IVC/">Simulation Chain: Inverted Coax Detector</a></li><li class="is-active"><a class="tocitem" href>Advanced Example: Custom Impurity Profile</a><ul class="internal"><li><a class="tocitem" href="#Define-the-Impurity-Density"><span>Define the Impurity Density</span></a></li><li><a class="tocitem" href="#Assign-the-Density-and-Calculate-the-Fields"><span>Assign the Density and Calculate the Fields</span></a></li><li><a class="tocitem" href="#1D-Plots-of-the-P-N-Junction"><span>1D Plots of the P-N Junction</span></a></li></ul></li></ul></li><li><a class="tocitem" href="../../api/">API</a></li><li><a class="tocitem" href="../../LICENSE/">LICENSE</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Advanced Example: Custom Impurity Profile</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Advanced Example: Custom Impurity Profile</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaPhysics/SolidStateDetectors.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaPhysics/SolidStateDetectors.jl/blob/main/docs/src/tutorials/custom_impurity_density_pn_junction_lit.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Advanced-Example:-Custom-Impurity-Profile"><a class="docs-heading-anchor" href="#Advanced-Example:-Custom-Impurity-Profile">Advanced Example: Custom Impurity Profile</a><a id="Advanced-Example:-Custom-Impurity-Profile-1"></a><a class="docs-heading-anchor-permalink" href="#Advanced-Example:-Custom-Impurity-Profile" title="Permalink"></a></h1><p>A very important input to the simulation is the impurity profile of the semiconductor. It influences the electric potential and, thus, the electric field, capacitances, drift paths and also the induced waveforms.</p><p>Arbitrary impurity density profiles can be defined and assigned to the semiconductor of the detector. Also have a look into the manual: <a href="../../man/electric_potential/#Impurity-Densities">Impurity Densities</a> and <a href="../../man/electric_potential/#Custom-Impurity-Density">Custom Impurity Density</a>.</p><p>As an example, we define the impurity profile of a simple <a href="https://en.wikipedia.org/wiki/P%E2%80%93n_junction">p-n junction</a> and calculate the electric potential and depleted region and reproduce the typical <a href="https://en.wikipedia.org/wiki/P%E2%80%93n_junction#/media/File:Pn-junction-equilibrium-graphs.png">plot</a> shown in various books explaining p-n junctions.</p><p>For this, we use one of the example detectors: the infinite parallel plate capacitor in cartesian coordinates. The plates span over <code>y</code> and <code>z</code>. It is made infinite by defining the world smaller than the contacts and using reflecting boundaries in <code>y</code> and <code>z</code>. Let&#39;s get started by loading the packages and the detector and have a look at its geometry:</p><pre><code class="language-julia hljs">using Plots
using SolidStateDetectors
using Unitful

sim = Simulation{Float32}(SSD_examples[:InfiniteParallelPlateCapacitor])
plot( sim.detector.semiconductor, fillalpha = 0.4)
plot!(sim.detector, xlims = (-0.006, 0.006), aspect_ratio = :none)</code></pre><img src="6093fa1d.svg" alt="Example block output"/><h2 id="Define-the-Impurity-Density"><a class="docs-heading-anchor" href="#Define-the-Impurity-Density">Define the Impurity Density</a><a id="Define-the-Impurity-Density-1"></a><a class="docs-heading-anchor-permalink" href="#Define-the-Impurity-Density" title="Permalink"></a></h2><p>Now, we define the model for the impurity density of the p-n junction. In order to do so, we need to define two things.</p><p>1. We have to define a <code>struct</code> which has to be    subtype of <code>SolidStateDetectors.AbstractImpurityDensity{T}</code>.    We define the model with two parameters in order to be able to vary the density level    in the p-type and n-type regions independently.    More parameters could be added, e.g., the position of the p-n junction.</p><pre><code class="language-julia hljs">struct PNJunctionImpurityDensity{T} &lt;: SolidStateDetectors.AbstractImpurityDensity{T}
    p_type_density::T
    n_type_density::T
end</code></pre><p>2. We have to define a method for <code>SolidStateDetectors.get_impurity_density</code> for our    just defined impurity density.    It has to take two arguments. An instance of our model and a point.    The function returns the impurity density at the respective position.    The returned value has to be in units of 1/m<span>$^{3}$</span>.</p><div class="admonition is-info"><header class="admonition-header">Sign of the impurity density</header><div class="admonition-body"><p>The sign of the impurity density determines whether the semiconductor is p-type or n-type.</p><p>p-type region &lt;-&gt; negative sign: Holes are the majority carriers and are free to move and diffuse into the n-type region.     Electrons are fixed in the lattice. Thus, a negative fixed space charge density is left behind in the depleted p-type region.</p><p>n-type region &lt;-&gt; positive sign: Electrons are the majority carriers and are free to move and diffuse into the p-type region.     Holes are fixed in the lattice. Thus, a positive fixed space charge density is left behind in the depleted n-type region.</p></div></div><pre><code class="language-julia hljs">function SolidStateDetectors.get_impurity_density(
    cdm::PNJunctionImpurityDensity{T},
    pt::SolidStateDetectors.AbstractCoordinatePoint{T}
)::T where {T}
    cpt = CartesianPoint(pt)
    x = cpt[1] # In this example, we only need the `x` coordinate of the point.
    if x &gt; 0
        -cdm.p_type_density # p-type region -&gt; electrons are fixed -&gt; negative charge
    else
        cdm.n_type_density  # n-type region -&gt; holes are fixed -&gt; positive charge
    end
end</code></pre><h2 id="Assign-the-Density-and-Calculate-the-Fields"><a class="docs-heading-anchor" href="#Assign-the-Density-and-Calculate-the-Fields">Assign the Density and Calculate the Fields</a><a id="Assign-the-Density-and-Calculate-the-Fields-1"></a><a class="docs-heading-anchor-permalink" href="#Assign-the-Density-and-Calculate-the-Fields" title="Permalink"></a></h2><p>Now, we create an instance of our model with reasonable parameters (for the geometry and bias voltage of the example detector) and assign it to the detector.</p><pre><code class="language-julia hljs">pn_junction_impurity_density = PNJunctionImpurityDensity{Float32}(3e16, 1.5e16)
sim.detector = SolidStateDetector(sim.detector, pn_junction_impurity_density);</code></pre><p>We are now ready to calculate the electric potential. Depletion handling has to be turned on, via the keyword <code>depletion_handling = true</code>, in order to detect the regions where the detector is depleted. The other settings for <code>calculate_electric_potential!</code> are very specific for this effectively 1D problem to be calculated in 3D. Afterwards, we also calculate the electric field and plot the electric potential, impurity scale map and the point type map. The two latter ones show us where the detector is depleted (<code>imp_scale == 1</code>).</p><pre><code class="language-julia hljs">calculate_electric_potential!(
    sim,
    convergence_limit = 1e-6,
    max_tick_distance = (0.002, 1, 1) .* u&quot;cm&quot;,
    min_tick_distance = (1e-7, 1, 1) .* u&quot;m&quot;,
    refinement_limits = [0.005, 0.001],
    depletion_handling = true
)
calculate_electric_field!(sim)

plot(
    plot(sim.electric_potential, y = 0),
    plot(sim.imp_scale, y = 0),
    plot(sim.point_types, y = 0),
    layout = (3, 1),
    aspect_ratio = :none,
    size = (800, 800)
)</code></pre><img src="bcf865f0.svg" alt="Example block output"/><h2 id="1D-Plots-of-the-P-N-Junction"><a class="docs-heading-anchor" href="#1D-Plots-of-the-P-N-Junction">1D Plots of the P-N Junction</a><a id="1D-Plots-of-the-P-N-Junction-1"></a><a class="docs-heading-anchor-permalink" href="#1D-Plots-of-the-P-N-Junction" title="Permalink"></a></h2><p>As this is in principle a 1D simulation, it is most reasonable to plot the charge density from the impurities, the electric potential and the electric field strength (here equals the <code>x</code> component of the electric field) only over <code>x</code>.</p><pre><code class="language-julia hljs">xs = uconvert.(u&quot;mm&quot;, sim.electric_potential.grid[1] * u&quot;m&quot;);
plot(
    begin
        ρ_x = map(x -&gt; SolidStateDetectors.get_impurity_density(
            sim.detector.semiconductor.impurity_density_model, CartesianPoint{Float32}(x, 0, 0)),
            sim.electric_potential.grid[1]
        )
        plot(xs, ρ_x .* sim.imp_scale[:, 1, 1], lw = 4, label =&quot;&quot;, xguide = &quot;x&quot;, unitformat = :square, yguide = &quot;\$\\rho\$ [e/m\$^3\$]&quot;)
        vline!([sim.detector.contacts[1].geometry.origin.x] * 1000, lw = 4, color = &quot;green&quot;, label = &quot;N+ Contact&quot;)
        vline!([sim.detector.contacts[2].geometry.origin.x] * 1000, lw = 4, color = &quot;red&quot;, label = &quot;P+ Contact&quot;)
        vline!([0], lw = 4, color = &quot;black&quot;, label = &quot;p-n junction&quot;)
    end,
    begin
        plot(xs, sim.electric_potential.data[:,1,1], lw = 4, label =&quot;&quot;, xguide = &quot;x&quot;, unitformat = :square, yguide = &quot;\$\\Phi\$ [V]&quot;)
        vline!([sim.detector.contacts[1].geometry.origin.x] * 1000, lw = 4, color = &quot;green&quot;, label = &quot;N+ Contact&quot;)
        vline!([sim.detector.contacts[2].geometry.origin.x] * 1000, lw = 4, color = &quot;red&quot;, label = &quot;P+ Contact&quot;)
        vline!([0], lw = 4, color = &quot;black&quot;, label = &quot;p-n junction&quot;)
    end,
    begin
        plot(xs, map(E -&gt; E[1]/1000, sim.electric_field.data[:,1,1]), lw = 4, label =&quot;&quot;, xguide = &quot;x&quot;, unitformat = :square, yguide = &quot;\$\\mathcal{E}_x\$ [V/mm]&quot;)
        vline!([sim.detector.contacts[1].geometry.origin.x] * 1000, lw = 4, color = &quot;green&quot;, label = &quot;N+ Contact&quot;)
        vline!([sim.detector.contacts[2].geometry.origin.x] * 1000, lw = 4, color = &quot;red&quot;, label = &quot;P+ Contact&quot;)
        vline!([0], lw = 4, color = &quot;black&quot;, label = &quot;p-n junction&quot;)
    end,
    layout = (3, 1),
    xlims = (-5.1, 5.1),
    size = (800, 800),
    lw = 2,
)</code></pre><img src="d5c456b8.svg" alt="Example block output"/><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../complete_simulation_chain_IVC/">« Simulation Chain: Inverted Coax Detector</a><a class="docs-footer-nextpage" href="../../api/">API »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.3.0 on <span class="colophon-date" title="Tuesday 26 March 2024 19:47">Tuesday 26 March 2024</span>. Using Julia version 1.10.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
